
<%= simple_form_for course, remote: true do |f| %>

  <%= f.fields_for :pickups, remote: true do |pickup| %>
    <%= pickup.input :address, label: false, required: :true, placeholder: 'Adresse de rammassage', input_html: { class: 'address-input' } %>
    <div class='hidden'>
      <%= pickup.input :date, as: :string, placeholder: 'Date', label: false, required: true, input_html: {class: "pickup-date-input"} %>
      <%= pickup.input :start_hour, as: :string, placeholder: 'pu start', label: false, required: true%>
      <%= pickup.input :end_hour, as: :string, placeholder: 'pu end', label: false, required: true%>
    </div>
  <% end %>

  <%= f.fields_for :drops do |drop| %>
    <%= drop.input :address, label: false, required: :true, placeholder: 'Adresse de livraison', input_html: { class: 'address-input' } %>
    <div class='hidden'>
      <%= drop.input :date, as: :string, placeholder: 'Date', label: false, required: true, input_html: {class: "drop-date-input"} %>
      <%= drop.input :start_hour, as: :string, placeholder: 'dr start', label: false, required: true%>
      <%= drop.input :end_hour, as: :string, placeholder: 'dr end', label: false, required: true%>
      <%= drop.input :details, as: :string, placeholder: 'details', label: false, required: true %>
    </div>
  <% end %>

  <div class="div-align" data-urgence='0' id="urgence">
      <div class="icon-w fs10"><div class='icon urgence urgence-1' data-tickets='0'></div><span class='urgence-0-day'>Aujourd'hui</span> avant <span class='urgence-0-hour'>19:00</span></div>
      <div class="icon-w fs10"><div class='icon urgence urgence-2' data-tickets='2'></div><span class='urgence-2-day'>Aujourd'hui</span>  avant <span class='urgence-2-hour'><%= (Time.now + (4*3600)).strftime("%H:%M") %></span></div>
      <div class="icon-w fs10"><div class='icon urgence urgence-3' data-tickets='1'></div><span class='urgence-1-day'>Aujourd'hui</span> avant <span class='urgence-1-hour'><%= (Time.now + (1*3600)).strftime("%H:%M") %></span></div>
    </div>


    <div class="div-align" data-volume='0' id="volume">
      <div class="icon-w fs10"><div class='icon volume volume-1 active' data-tickets='0'></div>Enveloppe ou petit plis</div>
      <div class="icon-w fs10"><div class='icon volume volume-2' data-tickets='1'></div>Gros colis ou > 5kg</div>
    </div>
  <br>
  <div class="main-toggle-resultat">
    <div class="left-box-resultat">
      <p class="left-distance"><span id="kilometers">0</span> km</p>
      <p class="left-urgence">Livraison avant <span class="heure">0</span></p>
      <p class="left-volume">Enveloppe</p>

    </div>

    <div class="right-box-resultat">
      <p class="right-distance sous-total">0</p>
      <p class="right-urgence sous-total">0</p>
      <p class="right-volume sous-total">0</p>
    </div>
  </div>
  <div class="total"><p class="total-text">Soit <span id='total-course'>0</span><%= user_signed_in? ? "ticket(s)" : " ticket(s)"  %> </p></div>

  <div class='hidden'>
    <%= f.fields_for(resource, as: resource_name, url: registration_path(resource_name)) do |user| %>
      <%= user.input :email %>
    <% end %>
    <input type="checkbox" id="stripe" name="stripe">
    <label for="stripe">stripe</label>

    <script src="https://js.stripe.com/v3/"></script>
    <script>





      document.body.addEventListener('ajax:success', (event) => {

        const checkoutId = new Promise((resolve, reject) => {
          console.log("1" + event.detail[0].checkout_id)
          resolve(event.detail[0].checkout_id)
        }, console.log("gerer l'erreur"));

        checkoutId.then((value) => {
          console.log(value)
          const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
          stripe.redirectToCheckout({
            sessionId: value
          });
        })

      });


    </script>

  </div>


  <%= f.submit "course", class: "bici-button hidden", id: 'save-course' %> <br>

  <% end %>


<button class="bici-button " id='continue'>Continuer</button>

